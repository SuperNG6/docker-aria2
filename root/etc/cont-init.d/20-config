#!/usr/bin/with-contenv bash

# make folders
mkdir -p \
	/config/ssl \
  /downloads/completed \
  /downloads/recycle

# copy files
if [[ ! -e /config/aria2.conf ]]
then
  cp /aria2/conf/aria2.conf.default /config/aria2.conf
fi

if [[ ! -e /config/aria2.session ]]
then
  touch /config/aria2.session
fi

if [[ ! -e /config/dht.dat ]]
then
  touch /config/dht.dat
fi

if [[ ! -e /config/move.log ]]
then
  touch /config/move.log
fi

if [[ ! -e /config/delete.log ]]
then
  touch /config/delete.log
fi

# move recycle bin or delete
if [[ "$RECYCLE" = "true" ]]
then
    sed -i 's@^\(on-download-stop=\).*@\1/aria2/script/recycle.sh@' /config/aria2.conf
else
    sed -i 's@^\(on-download-stop=\).*@\1/aria2/script/delete.sh@' /config/aria2.conf
fi

# move or keep
if [[ "$MOVE" = "true" ]]
then
    sed -i 's@^\(on-download-complete=\).*@\1/aria2/script/move.sh@' /config/aria2.conf
else
    sed -i 's@^\(on-download-complete=\).*@\1/aria2/script/delete.aria2.sh@' /config/aria2.conf
fi


# auto updatetracker
if [ "$UpdateTracker" == "true" ]
then
  bash /aria2/script/tracker.sh
fi
